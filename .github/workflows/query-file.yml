name: ğŸ“ æ‰¹é‡æŸ¥è¯¢ä»“åº“å†…æ–‡ä»¶

on:
  workflow_dispatch:
  schedule:
    - cron: '0 8 * * *'  # æ¯å¤© UTC 8ç‚¹

jobs:
  batch-query:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ›’ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: ğŸŸ© è®¾ç½® Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: ğŸ“¦ å®‰è£… Puppeteer
        run: npm install puppeteer

      - name: ğŸš€ è¿è¡Œæ‰¹é‡æŸ¥è¯¢ (è¯»å–æ–‡ä»¶æ¨¡å¼)
        # è¿è¡Œæˆ‘ä»¬é‡å‘½ååçš„è„šæœ¬
        run: node file-batch.js

      - name: ğŸ“¤ æäº¤ç»“æœ
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          
          if git diff --quiet HEAD -- output.json; then
            echo "â„¹ï¸ æ•°æ®æœªå˜åŒ–ï¼Œè·³è¿‡æäº¤ã€‚"
          else
            git add output.json
            git commit -m "ğŸ¤– è‡ªåŠ¨æ›´æ–°: æ‰¹é‡æŸ¥è¯¢ç»“æœ $(date)"
            git push origin main
          fi
